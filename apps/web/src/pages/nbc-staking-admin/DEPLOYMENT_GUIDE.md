# 代币部署和池管理完整指南

本指南将帮助您完成从代币部署到池管理的完整流程。

## 📋 完整流程概览

1. **部署代币合约** → 获取代币地址
2. **在管理页面添加池** → 创建新的奖励池
3. **批准代币给质押合约** → 允许合约转移代币
4. **设置初始奖励率** → 发送奖励代币到池

---

## 步骤 1: 部署代币合约

### 1.1 选择代币合约文件

在 `contracts/tokens/` 目录下选择对应的代币合约文件：
- `NBCToken.sol` - NBC 代币（18 位精度）
- `BTCToken.sol` - 比特币（8 位精度）
- `ETHToken.sol` - 以太坊（18 位精度）
- `SOLToken.sol` - Solana（18 位精度）
- `BNBToken.sol` - 币安币（18 位精度）
- `XRPToken.sol` - Ripple（18 位精度）
- `LTCToken.sol` - 莱特币（18 位精度）
- `DOGEToken.sol` - 狗狗币（18 位精度）
- `PEPEToken.sol` - Pepe（18 位精度）
- `USDTToken.sol` - Tether USD（6 位精度）
- `SUIToken.sol` - Sui（18 位精度）

### 1.2 部署参数

#### 18 位精度代币（NBC、ETH、SOL、BNB、XRP、LTC、DOGE、PEPE、SUI）

```solidity
// 示例：部署 NBC 代币，初始供应量 1,000,000 NBC
构造函数参数：
- initialSupply: 1000000 * 10^18  // 1,000,000 NBC (wei 单位)
- owner: 0xYourOwnerAddress        // 您的所有者地址
```

#### 8 位精度代币（BTC）

```solidity
// 示例：部署 BTC 代币，初始供应量 500 BTC
构造函数参数：
- initialSupply: 500 * 10^8        // 500 BTC (satoshi 单位)
- owner: 0xYourOwnerAddress        // 您的所有者地址
```

#### 6 位精度代币（USDT）

```solidity
// 示例：部署 USDT 代币，初始供应量 7,000 USDT
构造函数参数：
- initialSupply: 7000 * 10^6       // 7,000 USDT (micro 单位)
- owner: 0xYourOwnerAddress        // 您的所有者地址
```

### 1.3 部署后获取地址

部署成功后，记录下代币合约地址，例如：
```
0x8cEb9a93405CDdf3D76f72327F868Bd3E8755D89
```

---

## 步骤 2: 在管理页面添加池

### 2.1 访问管理页面

打开浏览器，访问：
```
http://localhost:5000/nbc-staking-admin
```

### 2.2 切换到"添加新池"标签

点击页面顶部的 **"添加新池"** 标签。

### 2.3 填写表单

#### 步骤 1: 奖励代币地址
- 输入部署后的代币合约地址（例如：`0x8cEb9a93405CDdf3D76f72327F868Bd3E8755D89`）

#### 步骤 2: 代币精度
- **BTC**: 输入 `8`
- **USDT**: 输入 `6`
- **其他代币（NBC、ETH、SOL 等）**: 输入 `18`

#### 步骤 3: 初始奖励率
- 输入每秒奖励的代币数量（例如：`0.00848`）
- 系统会根据上面指定的精度自动转换

#### 步骤 4: 奖励周期
- 推荐值：`31536000`（1 年 = 365 × 24 × 60 × 60 秒）
- 其他选项：
  - 6 个月：`15552000`
  - 3 个月：`7776000`
  - 1 个月：`2592000`

### 2.4 点击"添加池"

填写完成后，点击 **"添加池"** 按钮，确认交易。

---

## 步骤 3: 批准代币给质押合约

### 3.1 切换到"管理池"标签

点击页面顶部的 **"管理池"** 标签。

### 3.2 找到"批准代币"部分

在页面下方找到 **"批准代币（设置奖励率前必需）"** 部分。

### 3.3 填写批准信息

- **代币地址**: 输入代币合约地址（与步骤 2 中使用的地址相同）
- **代币精度**: 输入代币精度（与步骤 2 中使用的精度相同）
- **批准数量**: 输入要批准的数量（例如：`1000000` 表示 1,000,000 个代币）

### 3.4 点击"批准代币"

点击 **"批准代币"** 按钮，确认交易。

> ⚠️ **重要**: 批准数量应该大于或等于您计划发送到池的奖励数量。

---

## 步骤 4: 设置初始奖励率

### 4.1 在"管理池"标签中找到"设置奖励率"

找到 **"1. Set Reward Rate (notifyRewardAmount)"** 部分。

### 4.2 填写奖励信息

- **池索引**: 输入新添加池的索引（例如：如果这是第 11 个池，输入 `10`，因为索引从 0 开始）
- **代币精度**: 确保在"批准代币"部分设置了正确的精度（系统会记住这个值）
- **奖励数量**: 输入要发送到池的奖励代币数量（例如：`267425.28`）

### 4.3 点击"通知奖励数量"

点击 **"通知奖励数量"** 按钮，确认交易。

> 💡 **提示**: 
> - 如果周期已结束：新 rewardRate = 奖励 / rewardsDuration
> - 如果周期未结束：新 rewardRate = (奖励 + 剩余奖励) / rewardsDuration

---

## 📊 完整示例：部署 DOGE 代币池

### 1. 部署 DOGE 代币

```solidity
// 使用 Remix 或其他工具部署 DOGEToken.sol
构造函数参数：
- initialSupply: 10000000 * 10^18  // 10,000,000 DOGE
- owner: 0xYourOwnerAddress

部署后地址：0x8cEb9a93405CDdf3D76f72327F868Bd3E8755D89
```

### 2. 在管理页面添加池

- **奖励代币地址**: `0x8cEb9a93405CDdf3D76f72327F868Bd3E8755D89`
- **代币精度**: `18`
- **初始奖励率**: `0.00848`（每秒 0.00848 DOGE）
- **奖励周期**: `31536000`（1 年）

### 3. 批准代币

- **代币地址**: `0x8cEb9a93405CDdf3D76f72327F868Bd3E8755D89`
- **代币精度**: `18`
- **批准数量**: `1000000`（批准 1,000,000 DOGE）

### 4. 设置奖励率

- **池索引**: `10`（假设这是第 11 个池）
- **奖励数量**: `267425.28`（发送 267,425.28 DOGE 到池）

---

## ⚠️ 常见问题和注意事项

### 1. 精度不匹配

**问题**: 如果代币精度设置错误，会导致数量计算错误。

**解决**: 
- BTC 必须使用精度 `8`
- USDT 必须使用精度 `6`
- 其他代币使用精度 `18`

### 2. 授权不足

**问题**: 如果批准数量小于要发送的奖励数量，`notifyRewardAmount` 会失败。

**解决**: 确保批准数量 ≥ 要发送的奖励数量。

### 3. 池索引错误

**问题**: 如果使用错误的池索引，可能会修改错误的池。

**解决**: 
- 索引从 0 开始
- 第 1 个池的索引是 0
- 第 11 个池的索引是 10
- 可以在"设置"标签页查看总池数

### 4. 周期未结束

**问题**: `setRewardsDuration` 只能在周期结束后调用。

**解决**: 
- 等待当前周期结束（`block.timestamp > periodFinish`）
- 或者使用 `notifyRewardAmount` 来重置周期

---

## 🔗 相关资源

- 代币合约代码: `contracts/tokens/`
- 质押合约代码: `contracts/staking/NbcMultiRewardStaking.sol`
- 池配置: `apps/web/src/config/staking/poolConfig.ts`
- 管理页面: `http://localhost:5000/nbc-staking-admin`

---

## ✅ 检查清单

在完成所有步骤后，请确认：

- [ ] 代币合约已成功部署
- [ ] 代币地址已记录
- [ ] 在管理页面成功添加池
- [ ] 代币已批准给质押合约
- [ ] 初始奖励率已设置
- [ ] 池在前端页面可见
- [ ] APR 计算正确

完成以上所有步骤后，新的奖励池就可以正常使用了！🎉
