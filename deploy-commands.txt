# 部署命令 - 请在服务器上依次执行以下命令

# 1. 连接到服务器
ssh root@156.251.17.96
# 密码: Tk%Cv7AgMwpIv&Z

# 2. 执行以下命令（复制粘贴到服务器终端）

mkdir -p /www/pancake-staking
cd /www/pancake-staking

# 检查并安装必要工具
if ! command -v pnpm &> /dev/null; then npm install -g pnpm@10.13.1; fi
if ! command -v pm2 &> /dev/null; then npm install -g pm2; fi

# 克隆或更新代码
if [ -d .git ]; then
    git fetch origin
    git reset --hard origin/main
    git clean -fd
else
    git clone -b main https://github.com/nbc111/pancake-frontend--pancakeswap-pools.git .
fi

# 安装依赖
export NODE_OPTIONS="--max-old-space-size=8192"
pnpm install --frozen-lockfile

# 构建项目
cd apps/web
export NODE_OPTIONS="--max-old-space-size=8192"
export NODE_ENV="production"
pnpm next build --no-lint

# 启动服务
pm2 delete pancake-staking 2>/dev/null || true
pm2 start "pnpm start -- -p 5000" --name pancake-staking
pm2 save
pm2 startup

# 查看状态
pm2 list
pm2 logs pancake-staking --lines 20

